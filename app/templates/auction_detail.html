{% extends "layout.html" %}

{% block title %}{{ auction["title"] }}{% endblock %}

{% block content %}
<a href="{{ url_for('public.index') }}" class="back-link">â† Tillbaka till alla auktioner</a>

{% with messages = get_flashed_messages(with_categories=true) %}
  {% if messages %}
    <div class="flash-messages">
      {% for category, message in messages %}
        <div class="alert alert-{{ category }}">
          {{ message }}
        </div>
      {% endfor %}
    </div>
  {% endif %}
{% endwith %}

<h1 class="page-title">{{ auction["title"] }}</h1>
<p class="auction-desc">{{ auction["description"] }}</p>

<div class="detail-inline">
  <span class="pill"><strong>Startbud:</strong> {{ auction["starting_bid"] }} kr</span>
  <span class="pill"><strong>Slutar:</strong> {{ auction["end_datetime"] }}</span>
  <span class="pill">ğŸ‘ {{ likes }} / ğŸ‘ {{ dislikes }}</span>
</div>

<div class="detail-actions">
  <form method="post" action="{{ url_for('public.like_auction', auction_id=auction.id) }}">
    <button type="submit" class="search-btn">ğŸ‘ Gilla</button>
  </form>
  <form method="post" action="{{ url_for('public.dislike_auction', auction_id=auction.id) }}">
    <button type="submit" class="search-btn">ğŸ‘ Ogilla</button>
  </form>
</div>

<div class="detail-grid">

  <section class="panel">
    <h2 class="section-title">Budhistorik</h2>
    {% if bids %}
      <ol class="bid-list">
        {% for bid in bids %}
          <li class="bid-item">
            <strong>{{ bid.amount }} kr</strong>
            â€“ {{ bid.bidder_email }}
            â€“ {{ bid.created_at }}
          </li>
        {% endfor %}
      </ol>
    {% else %}
      <p class="muted">Inga bud har lagts Ã¤nnu.</p>
    {% endif %}
  </section>

  <section class="panel">
    <h2 class="section-title">LÃ¤gg ett bud</h2>
    <form method="post" action="{{ url_for('bid_bp.place_bid', auction_id=auction.id) }}" class="form">
      <label for="amount">Ditt bud (SEK)</label>
      <input
        type="number"
        id="amount"
        name="amount"
        min="{{ (bids[0].amount + 1) if bids else auction.starting_bid }}"
        required
      >

      <label for="bidder_email">Din e-post</label>
      <input type="email" id="bidder_email" name="bidder_email" required>

      <button type="submit" class="search-btn">LÃ¤gg bud</button>
    </form>
  </section>

</div>
{% endblock %}
